<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Publication</title>
        <link rel="icon" href="images/favicon.svg" type="image/png">
        <link href="css/publications-page.css" rel="stylesheet">
        <link href="css/footer.css" rel="stylesheet">
        <link href="css/header.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
        <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>

    </head>
    <body>
        <header>
            <div class="menu">
                <div class="menu-left">
                    <a href="index.html"><img alt="" src="images/logo_long_blanc.svg" class="menu-logo" /></a>
                    <div class="menu-link" id="menu-link">
                        <div class="options">
    
                            <div class="menu-option">
                                <div class="option-title">
                                    <p>Who we are</p>
                                    <img src="images/dropdown-arrow-menu.svg" alt="">
                                </div>
                                <div class="list-options">
                                    <a href="about-us.html">About us</a>
                                    <a href="about-us.html#team">Our team</a>
                                    <a href="about-us.html#clients">Partners</a>
                                </div>
                            </div>
    
                            <div class="menu-option">
                                <div class="option-title">
                                    <p>What we do</p>
                                    <img src="images/dropdown-arrow-menu.svg" alt="">
                                </div>
                                <div class="list-options">
                                    <a href="training.html">Training</a>
                                    <a href="services.html">Services</a>
                                    <a href="">Keynote</a>
                                </div>
                            </div>
    
                            <div class="menu-option">
                                <div class="option-title">
                                    <p>News</p>
                                    <img src="images/dropdown-arrow-menu.svg" alt="">
                                </div>
                                <div class="list-options">
                                    <a href="events.html">Events</a>
                                    <a href="publications.html">Publications</a>
                                    <a href="reports.html">In-depth analysis</a>
                                </div>
                            </div>
                        </div>
    
                        <div class="menu-global">
                            <a href="contact.html"><img src="images/footer-icon-phone.svg" alt="">Contact us</a>
                            <div class="lang-btn">
                                <img src="images/glob-icon.svg" alt="">
                                <select id="mobilLangDropdown" title="Choose a language">
                                    <option class="option" value="en">Global - EN</option>
                                    <option class="option" value="fr">Global - FR</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
    
                <div class="menu-end">
                    <div class="menu-global">
                        <a href="contact.html">Contact us</a>
                        <select id="desktopLangDropdown" title="Choose a language">
                            <option class="option" value="en">Global - EN</option>
                            <option class="option" value="fr">Global - FR</option>
                        </select>
                    </div>
                    <div class="menu-button">
                        <img id="menu-search-icon" src="images/menu-search-icon.svg" alt="">
                        <img id="menu-open" src="images/menu-icon.svg" alt="">
                    </div>
                </div>
            </div>
        </header>
        <main>
            <section class="hero"></section>
            <section class="page-title">
                <h1>Publication</h1>
            </section>
            <section class="blog-filter">
                <div class="input-group rounded">
                    <input type="search" id="search-input" class="form-control rounded" placeholder="Search" aria-label="Search" aria-describedby="search-addon" />
                    <button class="btn btn-outline-primary langue-en" type="button" id="search-addon">Search</button>
                    <button class="btn btn-outline-primary langue-fr" type="button" id="search-addon">Rechercher</button>
                </div>
                <div class="dropdown langue-en">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                        Filter by Date
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <li><a class="dropdown-item" href="#" data-filter="This week">This week</a></li>
                        <li><a class="dropdown-item" href="#" data-filter="This month">This month</a></li>
                        <li><a class="dropdown-item" href="#" data-filter="This six months">This six months</a></li>
                        <li><a class="dropdown-item" href="#" data-filter="This year">This year</a></li>
                        <li><a class="dropdown-item" href="#" data-filter="All">All the dates</a></li>
                    </ul>
                    <button type="button" class="btn btn-outline-danger d-none" id="clear-filter">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="dropdown langue-fr">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                        Filtrer par date
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <li><a class="dropdown-item" href="#" data-filter="This week">Cette semaine</a></li>
                        <li><a class="dropdown-item" href="#" data-filter="This month">Ce mois</a></li>
                        <li><a class="dropdown-item" href="#" data-filter="This six months">Ces six mois</a></li>
                        <li><a class="dropdown-item" href="#" data-filter="This year">Cette année</a></li>
                        <li><a class="dropdown-item" href="#" data-filter="All">Toutes les dates</a></li>
                    </ul>
                    <button type="button" class="btn btn-outline-danger d-none" id="clear-filter">
                        <span>&times;</span>
                    </button>
                </div>
            </section>
            <section class="blog">
                <!-- Loading spinner -->
                <div id="loading-spinner"></div>
                <!-- No results message -->
                <div id="no-results-message">No articles found</div>
                <div class="blog-boxs" id="blog-boxs">
                    <!-- Articles will be dynamically inserted here -->
                </div>
                <div class="blog-button-page">
                   <div class="blog-button">
                        <a href="publications.html"><button type="button" class="btn btn-outline-dark langue-en">< Previous</button></a>
                        <a href="publications.html"><button type="button" class="btn btn-outline-dark langue-fr">< Précédent</button></a>
                    </div>
                    <div class="blog-button">
                        <a href="publications.html"><button type="button" class="btn btn-outline-dark">1</button></a>
                    </div>
                    <div class="blog-button">
                        <a href="publications.html"><button type="button" class="btn btn-outline-dark langue-en">Next ></button></a>
                        <a href="publications.html"><button type="button" class="btn btn-outline-dark langue-fr">Suivant ></button></a>
                    </div> 
                </div>
                
            </section>
            <button id="scrollToTopBtn" title="Go to top">↑</button>
            <footer>
                <div class="footer-content">
                    <div class="footer-left">
                        <img src="images/logo_long_blanc.svg" alt="Logo">
                        <h2>Subscribe</h2>
                        <p>Stay up to date with all our news by subscribing to our newsletter.</p>
                        <div class="newsletter-fil">
                            <input type="email" class="form-control newsletter-form" id="newsletterEmail"
                                placeholder="email address">
                            <button type="button" class="btn btn-outline-warning" id="registerButton">Submit</button>
                        </div>
                    </div>
                    <div class="footer-right">
                        <div class="permalinks">
                            <a href="contact.html">Contact us</a>
                            <a href="">FAQ</a>
                            <a href="">Privacy policy</a>
                            <a href="">Terms of use</a>
                        </div>
                        <div class="list-info">
                            <div class="info">
                                <p>Sahel Politica, Chamerstrasse 172, 6300 Zug</p>
                                <img alt="" class="icon-info-footer" src="images/footer-icon-location.svg">
                            </div>
                            <div class="info">
                                <p>info@sahelpolitica.ch</p>
                                <img alt="" class="icon-info-footer" src="images/footer-icon-email.svg">
                            </div>
                        </div>
    
                    </div>
                </div>
    
                <div class="copyright">
                    <h6><img src="images/copyright.svg" alt=""> sahel policica, 2024, All rights reserved</h6>
                    <div class="socials">
                        <a target="_blank" href="https://www.youtube.com/@SahelPolitica_A"><img alt="Youtube"
                                src="images/footer-youtube-icon.svg"></a>
                        <a target="_blank" href="https://x.com/SahelPolitica"><img alt="X"
                                src="images/footer-x-icon.svg"></a>
                        <a target="_blank" href="https://www.linkedin.com/company/sahelpolitica/"><img alt="Linkedin"
                                src="images/footer-linkedin-icon.svg"></a>
                    </div>
            </footer>
        </main>
        <script type="module">
            const menuIcon = document.getElementById('menu-open');
            const dropLink = document.getElementById('menu-link');
    
            const openIcon = 'images/menu-icon.svg';  // Image pour ouvrir le menu
            const closeIcon = 'images/menu-close.svg';  // Image pour fermer le menu
    
            menuIcon.addEventListener('click', function () {
                if (dropLink.classList.contains('active')) {
                    // Si le menu est déjà ouvert, applique l'animation de fermeture
                    dropLink.classList.remove('active');
                    dropLink.classList.add('hide');
    
                    // Attends la fin de l'animation (1s ici), puis masque complètement l'élément
                    setTimeout(function () {
                        dropLink.classList.remove('hide');
                        dropLink.style.display = 'none'; // Cache le menu après l'animation
                    }, 1000); // Temps de l'animation
    
                    // Change l'icône en "menu ouvert"
                    menuIcon.src = openIcon;
                } else {
                    // Si le menu est fermé, montre-le et applique l'animation d'ouverture
                    dropLink.style.display = 'flex'; // Affiche le menu avant l'animation
                    dropLink.classList.add('active');
    
                    // Change l'icône en "fermer"
                    menuIcon.src = closeIcon;
                }
            });
    
            // Sélectionner tous les menus dans .menu-link
            const menus = document.querySelectorAll('.menu-link .menu-option');
    
            // Ajouter un écouteur d'événement de clic pour chaque bouton
            menus.forEach(menu => {
                menu.addEventListener('click', function () {
                    // Si ce bouton est déjà actif, on le désactive (on retire 'active')
                    if (this.classList.contains('active')) {
                        this.classList.remove('active');
                    } else {
                        // Désactiver le bouton actif actuel s'il y en a un
                        const activeButton = document.querySelector('.other-filter .btn.active');
                        if (activeButton) {
                            activeButton.classList.remove('active');
                        }
                        // Activer le bouton cliqué
                        this.classList.add('active');
                    }
                });
            });
    
        </script>
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-analytics.js";
            import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";
            
            const firebaseConfig = {
                apiKey: "API_KEY",
                authDomain: "sahelpolitica.firebaseapp.com",
                projectId: "sahelpolitica",
                storageBucket: "sahelpolitica.appspot.com",
                messagingSenderId: "11417703739",
                appId: "1:11417703739:web:882052b747e7b761bdd31e",
                measurementId: "G-WFFDBTWRKV"
            };
            
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            const db = getFirestore(app);
            
            async function fetchArticles(searchTerm = '', filter = '') {
                const articlesContainer = document.getElementById('blog-boxs');
                const loadingSpinner = document.getElementById('loading-spinner');
                const noResultsMessage = document.getElementById('no-results-message');
                
                // Show loading spinner
                loadingSpinner.classList.remove('d-none');
                articlesContainer.classList.add('d-none');
                noResultsMessage.classList.add('d-none');
                
                try {
                    const querySnapshot = await getDocs(collection(db, 'Articles'));
                    const articles = querySnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
            
                    // Apply search filter first
                    const filteredBySearch = searchTerm ? articles.filter(article =>
                        article.title.toLowerCase().includes(searchTerm.toLowerCase())
                    ) : articles;
            
                    // Apply date filter if selected
                    const filteredByDate = filter && filter !== 'Filter by Date' ? filteredBySearch.filter(article => {
                        const articleDate = new Date(article.date.seconds * 1000);
                        const now = new Date();
                        switch (filter) {
                            case 'This week':
                                const weekAgo = new Date(now.setDate(now.getDate() - 7));
                                return articleDate >= weekAgo;
                            case 'This month':
                                const monthAgo = new Date(now.setMonth(now.getMonth() - 1));
                                return articleDate >= monthAgo;
                            case 'This six months':
                                const sixMonthsAgo = new Date(now.setMonth(now.getMonth() - 6));
                                return articleDate >= sixMonthsAgo;
                            case 'This year':
                                const yearAgo = new Date(now.setFullYear(now.getFullYear() - 1));
                                return articleDate >= yearAgo;
                            default:
                                return true;
                        }
                    }) : filteredBySearch;
            
                    // Sort articles by date in descending order
                    filteredByDate.sort((a, b) => b.date.seconds - a.date.seconds);
            
                    // Clear previous content
                    articlesContainer.innerHTML = '';
            
                    if (filteredByDate.length === 0) {
                        // Display no results message
                        noResultsMessage.classList.remove('d-none');
                    } else {
                        // Display filtered articles
                        filteredByDate.forEach(article => {
                            const articleElement = document.createElement('div');
                            articleElement.classList.add('blog-article');
                            
                            articleElement.style.backgroundImage = `url(${article.imageUrl})`;
                            articleElement.style.backgroundSize = 'cover'; // Cover the entire element
                            articleElement.style.backgroundPosition = 'center'; // Center the image
                        
                            articleElement.innerHTML = `
                                <div class="blog-article-title">
                                    <h6 class="langue-en">${article.title}</h6>
                                    <h6 class="langue-fr">${article.titleFR}</h6>
                                </div>
                                <div class="blog-article-info">
                                    <p class="blog-article-date">${new Date(article.date.seconds * 1000).toLocaleString()}</p>
                                    <p class="langue-en"><a href="article.html?id=${article.id}">Read more --></a></p>
                                    <p class="langue-fr"><a href="article.html?id=${article.id}">Lire plus --></a></p>
                                </div>
                            `;
                            articlesContainer.appendChild(articleElement);
                        });
                    }
                } catch (error) {
                    console.error("Error fetching articles: ", error);
                } finally {
                    // Hide loading spinner and show articles container
                    loadingSpinner.classList.add('d-none');
                    articlesContainer.classList.remove('d-none');
                }
            }
            
            document.addEventListener('DOMContentLoaded', () => fetchArticles());
            
            document.querySelectorAll('.dropdown-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const filterText = e.target.getAttribute('data-filter');
                    document.getElementById('dropdownMenuButton').textContent = filterText;
                    document.getElementById('clear-filter').classList.remove('d-none');
                    fetchArticles(document.getElementById('search-input').value.trim(), filterText);
                });
            });
            
            document.getElementById('clear-filter').addEventListener('click', () => {
                document.getElementById('dropdownMenuButton').textContent = 'Filter by Date';
                document.getElementById('clear-filter').classList.add('d-none');
                fetchArticles(); // Clear all filters and search
            });
            
            document.getElementById('search-addon').addEventListener('click', () => {
                const searchTerm = document.getElementById('search-input').value.trim();
                fetchArticles(searchTerm, document.getElementById('dropdownMenuButton').textContent);
            });
        </script>
        
        <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>

    <script>
        // Affiche le bouton lorsque l'utilisateur fait défiler vers le bas de 20 pixels à partir du haut du document
        window.onscroll = function() { scrollFunction() };
    
        function scrollFunction() {
            const scrollToTopBtn = document.getElementById("scrollToTopBtn");
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                scrollToTopBtn.style.display = "block";
            } else {
                scrollToTopBtn.style.display = "none";
            }
        }
    
        // Lorsque l'utilisateur clique sur le bouton, fait défiler vers le haut de la page
        document.getElementById("scrollToTopBtn").addEventListener("click", function() {
            document.body.scrollTop = 0; // Pour Safari
            document.documentElement.scrollTop = 0; // Pour Chrome, Firefox, IE et Opera
        });
    </script>
    <script src="js/indexJs.js"></script>
    <script src="js/script-language.js"></script>
    </body>
</html>